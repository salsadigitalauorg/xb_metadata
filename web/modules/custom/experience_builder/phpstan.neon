parameters:
  level: 8
  fileExtensions:
    - php
    - module
    - inc
    - install
    - theme
    - profile
  excludePaths:
    - modules/xb_vite
    # These are 1:1 copies from Drupal core, with trivial additions that cannot have significant PHPStan impact. PHPStan compliance should happen upstream.
    - src/Plugin/DataTypeOverride
    - src/Plugin/Field/FieldTypeOverride
    - src/TypedData/BetterEntityDataDefinition.php
    # The npm package flatted includes PHP files ðŸ™ƒ
    # Note: `ui/node_modules` may exist on local development environments, but is deleted on CI to avoid slow tests,
    # hence the `(?)`.
    # @todo Remove once https://www.drupal.org/project/drupal/issues/3249443 is fixed.
    - ui/node_modules (?)
    # This trait decorates core's \Drupal\Core\Test\FunctionalTestSetupTrait::prepareSettings(), which itself triggers a PHPStan warning that core ignores. Match that.
    - tests/src/Traits/ContribStrictConfigSchemaTestTrait.php
  treatPhpDocTypesAsCertain: false
  drupal:
    entityMapping:
      xb_asset_library:
        class: Drupal\experience_builder\Entity\AssetLibrary
      component:
        class: Drupal\experience_builder\Entity\Component
      js_component:
        class: Drupal\experience_builder\Entity\JavaScriptComponent
      xb_page:
        class: Drupal\experience_builder\Entity\Page
      page_region:
        class: Drupal\experience_builder\Entity\PageRegion
      pattern:
        class: Drupal\experience_builder\Entity\Pattern
      staged_config_update:
        class: Drupal\experience_builder\Entity\StagedConfigUpdate
  ignoreErrors:
    - identifier: missingType.iterableValue
    - identifier: missingType.generics
    # Ignore invalid phpunit methods/covers
    # @todo Remove in https://drupal.org/i/3533845
    - identifier: phpunit.coversMethod
    - identifier: phpunit.covers

    -
      message: "#^Class .* extends @internal class#"
      count: 1
      path: src/MediaLibraryXbPropOpener.php
    -
      message: "#^Access to an undefined property#"
      count: 1
      path: src/PropSource/StaticPropSource.php
    -
      messages:
        - "#^Missing cache backend declaration for performance\\.$#"
      paths:
        - src/Plugin/BlockManager.php
        - src/Plugin/ComponentPluginManager.php
    -
      message: "#^Method Drupal\\\\experience_builder\\\\Entity\\\\Pattern\\:\\:preCreate\\(\\) has no return type specified\\.$#"
      count: 1
      path: src/Entity/Pattern.php
